(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Q=e=>{e.remove()},X=(e,t)=>{const o=e.querySelector(".card__like-button"),r=e.querySelector(".card__like-count");o.classList.toggle("card__like-button_is-active"),r.textContent=t},Y=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),P=(e,t,{onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n,onInfoButton:c})=>{const s=Y(),m=s.querySelector(".card__like-button"),d=s.querySelector(".card__control-button_type_delete"),i=s.querySelector(".card__image"),R=s.querySelector(".card__like-count"),z=s.querySelector(".card__control-button_type_info");i.src=e.link,i.alt=e.name,s.querySelector(".card__title").textContent=e.name;const K=e.likes.some(G=>G._id===t._id);return R.textContent=e.likes.length,K&&m.classList.add("card__like-button_is-active"),r&&m.addEventListener("click",()=>r(s,e._id)),e.owner._id===t._id?d.addEventListener("click",()=>n(s,e._id)):d.remove(),o&&i.addEventListener("click",()=>o({name:e.name,link:e.link})),c&&z.addEventListener("click",()=>c(e._id)),s},M=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",M)},u=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",M)},Z=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{u(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&u(e)})},ee=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},T=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},te=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?T(e,t,o):ee(e,t,t.validationMessage,o)},oe=e=>e.some(t=>!t.validity.valid),x=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},re=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},w=(e,t,o)=>{oe(e)?x(t,o):re(t,o)},ne=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);w(o,r,t),o.forEach(n=>{n.addEventListener("input",function(){te(e,n,t),w(o,r,t)})})},ce=(e,t)=>{const o=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{e.querySelector(`#${n.id}-error`)&&T(e,n,t)}),r&&x(r,t)},se=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",function(r){r.preventDefault()}),ne(o,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"a260c93f-d1ec-4087-bcd1-b826cf3478b7","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),le=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(p),$=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(p),ie=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(p),ae=({avatar:e})=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(p),ue=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(p),pe=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(p),de=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(o=>p(o)),A=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),y=S.querySelector(".popup__form"),D=y.querySelector(".popup__input_type_name"),U=y.querySelector(".popup__input_type_description"),v=document.querySelector(".popup_type_new-card"),h=v.querySelector(".popup__form"),_e=h.querySelector(".popup__input_type_card-name"),me=h.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),B=C.querySelector(".popup__image"),fe=C.querySelector(".popup__caption"),ye=document.querySelector(".profile__edit-button"),he=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),E=I.querySelector(".popup__form"),be=E.querySelector(".popup__input"),L=document.querySelector(".popup_type_remove-card"),b=document.querySelector(".popup_type_info"),Le=document.getElementById("popup-info-definition-template"),Se=document.getElementById("popup-info-user-preview-template"),F={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},a=(e,t,o,r)=>{e.textContent=t?o:r};let N=null,O=null;const W=(e,t)=>{_(L),N=e,O=t};L.addEventListener("submit",e=>{e.preventDefault(),a(e.submitter,!0,"Удаление...","Да"),pe(O).then(()=>{Q(N)}).catch(t=>{console.log(t)}).finally(()=>{a(e.submitter,!1,"Удаление...","Да"),u(L)})});const V=(e,t)=>{const o=e.querySelector(".card__like-button").classList.contains("card__like-button_is-active");de(t,o).then(r=>{X(e,r.likes.length)}).catch(r=>{console.log(r)})},H=({name:e,link:t})=>{B.src=t,B.alt=e,fe.textContent=e,_(C)},ve=e=>{e.preventDefault(),a(e.submitter,!0,"Сохранение...","Сохранить"),ie({name:D.value,about:U.value}).then(t=>{q.textContent=t.name,k.textContent=t.about}).catch(t=>{console.log(t)}).finally(()=>{a(e.submitter,!1,"Сохранение...","Сохранить"),u(S)})},Ce=e=>{e.preventDefault(),a(e.submitter,!0,"Сохранение...","Сохранить"),ae({avatar:be.value}).then(t=>{g.style.backgroundImage=`url(${t.avatar})`}).catch(t=>{console.log(t)}).finally(()=>{a(e.submitter,!1,"Сохранение...","Сохранить"),u(I)})},qe=e=>{e.preventDefault(),a(e.submitter,!0,"Создание...","Создать"),ue({name:_e.value,link:me.value}).then(t=>{A.prepend(P(t,t.owner,{onPreviewPicture:H,onLikeIcon:V,onDeleteCard:W,onInfoButton:J}))}).catch(t=>{console.log(t)}).finally(()=>{a(e.submitter,!0,"Создание...","Создать"),u(v)})},j=(e,t)=>e.content.querySelector(t).cloneNode(!0),ke=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),f=(e,t)=>{const o=j(Le,".popup__info-item"),r=o.querySelector(".popup__info-term"),n=o.querySelector(".popup__info-description");return r.textContent=e,n.textContent=t,o},ge=e=>{const t=j(Se,".popup__list-item");return t.textContent=e,t},J=e=>{const t=b.querySelector(".popup__info"),o=b.querySelector(".popup__list");t.innerHTML="",o.innerHTML="";let r=null,n=null,c=null,s=null,m=null;$().then(d=>{d.forEach(i=>{i._id===e&&(r=i.name,n=i.owner.name,c=i.likes.length,s=i.likes,m=i.createdAt)}),t.append(f("Описание:",r),f("Дата создания:",ke(new Date(m))),f("Владелец:",n),f("Количество лайков:",c)),s.forEach(i=>{o.append(ge(i.name))}),_(b)}).catch(d=>{console.log(d)})};y.addEventListener("submit",ve);h.addEventListener("submit",qe);E.addEventListener("submit",Ce);ye.addEventListener("click",()=>{D.value=q.textContent,U.value=k.textContent,ce(y,F),_(S)});g.addEventListener("click",()=>{E.reset(),_(I)});he.addEventListener("click",()=>{h.reset(),_(v)});const Ie=document.querySelectorAll(".popup");Ie.forEach(e=>{Z(e)});se(F);Promise.all([$(),le()]).then(([e,t])=>{e.forEach(o=>{A.append(P(o,t,{onPreviewPicture:H,onLikeIcon:V,onDeleteCard:W,onInfoButton:J}))}),q.textContent=t.name,g.style.backgroundImage=`url(${t.avatar})`,k.textContent=t.about}).catch(e=>{console.log(e)});
